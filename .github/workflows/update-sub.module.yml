name: Update submodules

on:
  workflow_dispatch:
    inputs:
      branch_update:
        default: 'main'
        required: false
        type: string

jobs:
  update-submodules:
    runs-on: ubuntu-latest
    steps:
    
     - name: Check out xyna-modeller
       uses: actions/checkout@v4
       
     - name:
       run: |
         git branch ${{ inputs.branch_update }}
         git switch ${{ inputs.branch_update }}

     - name: init submodule
       run: |
         git submodule update --init impl/projects/xyna/src/app/zeta
         git submodule update --init impl/projects/xyna/src/app/xfm/acm
         git submodule update --init impl/projects/xyna/src/app/xfm/factorymanager
         git submodule update --init impl/projects/xyna/src/app/xfm/processmodeller
         git submodule update --init impl/projects/xyna/src/app/xfm/processmonitor
         git submodule update --init impl/projects/xyna/src/app/xfm/testfactory
         git submodule update --init impl/projects/xyna/src/app/xfm/yggdrasil

     - name: update dependencies
       run: git submodule foreach git checkout remotes/origin/main
       
     - name: add changes
       run: |
         git add impl/projects/xyna/src/app/zeta
         git add impl/projects/xyna/src/app/xfm/acm
         git add impl/projects/xyna/src/app/xfm/factorymanager
         git add impl/projects/xyna/src/app/xfm/processmodeller
         git add impl/projects/xyna/src/app/xfm/processmonitor
         git add impl/projects/xyna/src/app/xfm/testfactory
         git add impl/projects/xyna/src/app/xfm/yggdrasil

     - name: Commit
       run: |
         git config --global user.name '${{ github.actor }}'
         git config --global user.email '${{ github.actor }}@users.noreply.github.com'
         git remote set-url origin https://x-access-token:${{ secrets.PAT }}@github.com/${{ github.repository }}
         git commit -m "Update dependencies"
         git push
     
     - name: Create Pull Request
       run: |
         gh pr create --title "Update Submodule Dependencies" --reviewer Xyna-Factory/xyna_reviewers --base main --head ${{ inputs.branch_update }}